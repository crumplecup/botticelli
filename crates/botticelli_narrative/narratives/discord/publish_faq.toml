# Publish FAQ Narrative
# Demonstrates: Carousel-generated content, table references, selection, bot publishing

[narrative]
name = "publish_faq"
description = "Setup FAQ channel, generate content, select best, publish, and pin"
skip_content_generation = true
model = "gemini-2.5-flash"

[toc]
order = ["create_channel", "clear_channel", "generate_content", "select_best", "publish_message", "pin_message"]

# Define bot commands
[bots.create_channel]
platform = "discord"
command = "channels.get_or_create"
guild_id = "1439415903753076859"
name = "faq"
channel_type = "text"

[bots.clear_channel]
platform = "discord"
command = "messages.clear"
guild_id = "1439415903753076859"
channel_id = "${create_channel.id}"  # Use channel ID from create_channel act
limit = 100

[bots.publish_message]
platform = "discord"
command = "messages.send"
guild_id = "1439415903753076859"
channel_id = "${create_channel.id}"  # Use channel ID from create_channel act
content = "{{select_best}}"

[bots.pin_message]
platform = "discord"
command = "messages.pin"
guild_id = "1439415903753076859"
channel_id = "${create_channel.id}"  # Use channel ID from create_channel act
message_id = "${publish_message.id}"  # Extract message ID from publish act JSON response

# Define nested narrative for content generation
[narratives.generate_content]
narrative = "faq_content_generation"

# Define table reference for loading generated FAQs
[tables.faq_content]
table_name = "faq_content"
limit = 100
format = "markdown"

[acts]
# Act 1: Create FAQ channel if it doesn't exist (optional, will error if exists)
create_channel = ["bots.create_channel"]

# Act 2: Clear any existing messages in the FAQ channel
clear_channel = ["bots.clear_channel"]

# Act 3: Run FAQ content generation to populate the table
generate_content = ["narratives.generate_content"]

# Act 4: Compile all FAQ questions into a single formatted document
select_best = [
  "tables.faq_content",
  """You are formatting FAQ questions for the Botticelli Discord server.

The table above contains 9 FAQ questions generated iteratively. Your task:
1. Organize all 9 questions into logical categories (Getting Started, Features, Usage, etc.)
2. Format as a single cohesive FAQ document using Discord markdown
3. Add a header: "# ðŸ“š Botticelli FAQ"
4. Use emojis for category headers
5. Ensure proper Discord formatting (code blocks, bold, links)
6. Add a footer: "Need more help? Ask in #support!"

Output ONLY the formatted FAQ document (no explanation, no JSON, just the markdown content).""",
]

# Act 5: Publish to Discord FAQ channel (uses output from select_best)
publish_message = ["bots.publish_message"]

# Act 6: Pin the FAQ message to the top of the channel
pin_message = ["bots.pin_message"]
