# Discord Post Generation Carousel
# Five narratives that each generate-critique-refine a single post
# Each narrative auto-stores to potential_discord_posts table at completion
#
# Usage:
#   Single post:  just narrate generation_carousel.feature
#   Batch of 50:  just narrate generation_carousel.batch_generate

# === Batch Generator: Run all five narratives 10 times (50 posts) ===
[narratives.batch_generate]
name = "generation_batch_50"
description = "Run all five generation narratives 10 times using carousel mode"

[narratives.batch_generate.carousel]
iterations = 3

[narratives.batch_generate.toc]
order = ["feature", "usecase", "tutorial", "community", "problem"]

[narratives.batch_generate.acts.feature]
narrative = "feature"

[narratives.batch_generate.acts.usecase]
narrative = "usecase"

[narratives.batch_generate.acts.tutorial]
narrative = "tutorial"

[narratives.batch_generate.acts.community]
narrative = "community"

[narratives.batch_generate.acts.problem]
narrative = "problem"

# === Shared Model Configuration ===
[config.gemini]
model = "gemini-2.5-flash-lite"
temperature = 0.8
max_tokens = 600

# === Shared Resources ===

# Load Botticelli context for the LLM
[media.context]
file = "BOTTICELLI_CONTEXT.md"

# === Shared Act Definitions ===

[acts.critique]
model = "gemini-2.5-flash-lite"
temperature = 0.3
max_tokens = 400

[[acts.critique.input]]
type = "text"
content = """
Critique this Discord post for content quality:

{{generate}}

Evaluate:
1. Engagement (hook, CTA)
2. Clarity (structure, readability)
3. Accuracy (matches Botticelli capabilities)
4. Discord formatting (markdown, emojis)
5. Length (under 1800 chars)

Provide specific, actionable improvements.
"""

[acts.refine]
model = "gemini-2.5-flash-lite"
temperature = 0.7
max_tokens = 600

[[acts.refine.input]]
type = "text"
content = """
Improve the post based on critique. Focus on content quality, not JSON formatting.

Original: {{generate}}

Critique: {{critique}}

Output the improved post text (plain text, no JSON yet):
"""

[acts.format_json]
model = "gemini-2.5-flash-lite"
temperature = 0.1
max_tokens = 1200

[[acts.format_json.input]]
type = "text"
content = """
Format this content as valid JSON matching this exact schema.

Content to format:
{{refine}}

Required Schema:
{
  "text_content": string (required, 10-2000 characters),
  "content_type": string (optional, defaults to "discord_post"),
  "source": string (optional, e.g., "generation_carousel"),
  "tags": array of strings (optional, relevant keywords)
}

CRITICAL RULES:
1. Output ONLY the JSON object - no markdown blocks (```json), no explanations, no surrounding text
2. Start your response with { and end with }
3. Use exact field names (text_content not textContent)
4. Ensure all strings are properly quoted and escaped
5. Arrays must have proper comma separation
6. Do not truncate - complete the JSON fully
7. text_content must be a plain string, not a nested object

Example output format:
{
  "text_content": "Your Discord post content here...",
  "content_type": "discord_post",
  "source": "generation_carousel",
  "tags": ["feature", "automation", "ai"]
}

Now format the content above as JSON.
"""

[acts.audit_json]
model = "gemini-2.5-flash-lite"
temperature = 0.1
max_tokens = 1200

[[acts.audit_json.input]]
type = "text"
content = """
Audit this JSON for schema compliance and fix any issues.

JSON to audit:
{{format_json}}

Required Schema:
{
  "text_content": string (required, 10-2000 characters),
  "content_type": string (optional),
  "source": string (optional),
  "tags": array of strings (optional)
}

VALIDATION CHECKLIST:
- ✓ Starts with { and ends with } (no markdown blocks)
- ✓ All field names use snake_case (text_content not textContent)
- ✓ text_content is a plain string (not nested object)
- ✓ All values match their types (string, array, etc.)
- ✓ No extra fields outside the schema
- ✓ No explanatory text before or after JSON
- ✓ JSON is complete (not truncated mid-string)

CRITICAL RULES:
1. Output ONLY the JSON object - no markdown (```json), no explanations
2. Start with { and end with }
3. If valid, output it unchanged
4. If invalid, output the corrected version
5. Ensure all strings are properly quoted and escaped
6. Do not truncate - complete the JSON fully

Example valid output:
{
  "text_content": "Your Discord post content here...",
  "content_type": "discord_post",
  "source": "generation_carousel",
  "tags": ["feature", "automation"]
}

Now audit the JSON above and output the valid/corrected version.
"""

# === Narrative 1: Feature Showcase ===
[narratives.feature]
name = "feature_showcase"
description = "Generate Discord post showcasing a Botticelli feature"
target = "potential_discord_posts"

[narratives.feature.toc]
order = ["generate", "critique", "refine", "format_json", "audit_json"]

[narratives.feature.acts.generate]
model = "gemini-2.5-flash-lite"
temperature = 0.8
max_tokens = 600

[[narratives.feature.acts.generate.input]]
type = "text"
file = "BOTTICELLI_CONTEXT.md"

[[narratives.feature.acts.generate.input]]
type = "text"
content = """
Read the Botticelli context document above. Use this information to create an engaging Discord post.

Focus: Feature showcase
Angle: Highlight a specific Botticelli capability

Requirements:
- Length: Under 1800 characters
- Format: Discord markdown (**, *, __, ~~, ||) with emojis
- Structure: Hook, explanation, example, call-to-action
- Tone: Enthusiastic but professional
- Tags: Include "feature" plus relevant feature names

Write the post text (plain text, we'll format as JSON later):
"""

# === Narrative 2: Use Cases ===
[narratives.usecase]
name = "usecase_showcase"
description = "Generate Discord post about real-world Botticelli use cases"
target = "potential_discord_posts"

[narratives.usecase.toc]
order = ["generate", "critique", "refine", "format_json", "audit_json"]

[narratives.usecase.acts.generate]
model = "gemini-2.5-flash-lite"
temperature = 0.8
max_tokens = 600

[[narratives.usecase.acts.generate.input]]
type = "text"
file = "BOTTICELLI_CONTEXT.md"

[[narratives.usecase.acts.generate.input]]
type = "text"
content = """
Read the Botticelli context document above. Use this information to create an engaging Discord post.

Focus: Real-world use cases
Angle: Show practical applications

Requirements:
- Length: Under 1800 characters
- Format: Discord markdown (**, *, __, ~~, ||) with emojis
- Structure: Hook, explanation, example, call-to-action
- Tone: Enthusiastic but professional
- Tags: Include "usecase" plus relevant application domains

Write the post text (plain text, we'll format as JSON later):
"""

# === Narrative 3: Tutorial ===
[narratives.tutorial]
name = "tutorial_guide"
description = "Generate Discord post with tutorial or how-to content"
target = "potential_discord_posts"

[narratives.tutorial.toc]
order = ["generate", "critique", "refine", "format_json", "audit_json"]

[narratives.tutorial.acts.generate]
model = "gemini-2.5-flash-lite"
temperature = 0.8
max_tokens = 600

[[narratives.tutorial.acts.generate.input]]
type = "text"
file = "BOTTICELLI_CONTEXT.md"

[[narratives.tutorial.acts.generate.input]]
type = "text"
content = """
Read the Botticelli context document above. Use this information to create an engaging Discord post.

Focus: Tutorial or how-to guide
Angle: Educational, step-by-step

Requirements:
- Length: Under 1800 characters
- Format: Discord markdown (**, *, __, ~~, ||) with emojis
- Structure: Hook, explanation, example, call-to-action
- Tone: Enthusiastic but professional
- Tags: Include "tutorial" plus relevant topics

Write the post text (plain text, we'll format as JSON later):
"""

# === Narrative 4: Community ===
[narratives.community]
name = "community_engagement"
description = "Generate Discord post for community engagement"
target = "potential_discord_posts"

[narratives.community.toc]
order = ["generate", "critique", "refine", "format_json", "audit_json"]

[narratives.community.acts.generate]
model = "gemini-2.5-flash-lite"
temperature = 0.8
max_tokens = 600

[[narratives.community.acts.generate.input]]
type = "text"
file = "BOTTICELLI_CONTEXT.md"

[[narratives.community.acts.generate.input]]
type = "text"
content = """
Read the Botticelli context document above. Use this information to create an engaging Discord post.

Focus: Community engagement
Angle: Encourage participation, questions, sharing

Requirements:
- Length: Under 1800 characters
- Format: Discord markdown (**, *, __, ~~, ||) with emojis
- Structure: Hook, explanation, example, call-to-action
- Tone: Enthusiastic but professional
- Tags: Include "community" plus engagement type

Write the post text (plain text, we'll format as JSON later):
"""

# === Narrative 5: Problem-Solution ===
[narratives.problem]
name = "problem_solution"
description = "Generate Discord post about problems Botticelli solves"
target = "potential_discord_posts"

[narratives.problem.toc]
order = ["generate", "critique", "refine", "format_json", "audit_json"]

[narratives.problem.acts.generate]
model = "gemini-2.5-flash-lite"
temperature = 0.8
max_tokens = 600

[[narratives.problem.acts.generate.input]]
type = "text"
file = "BOTTICELLI_CONTEXT.md"

[[narratives.problem.acts.generate.input]]
type = "text"
content = """
Read the Botticelli context document above. Use this information to create an engaging Discord post.

Focus: Problem-solution narrative
Angle: Common challenges Botticelli solves

Requirements:
- Length: Under 1800 characters
- Format: Discord markdown (**, *, __, ~~, ||) with emojis
- Structure: Hook, explanation, example, call-to-action
- Tone: Enthusiastic but professional
- Tags: Include "problem_solution" plus relevant problem domains

Write the post text (plain text, we'll format as JSON later):
"""
